// ==UserScript==
// @name         ÂÄã‰∫∫Á©∫ÈñìÁòãÁãÇÊªæÂãïÂô® + ‰∫∫Â∑•Â±ïÈñãËºîÂä©Âô®
// @namespace    http://tampermonkey.net/
// @version      1.6
// @description  ÈñãÂïüÊªæÂãïÂæåËá™ÂãïÊ®ôË®òÊâÄÊúâ‚ÄúÂ±ïÈñãÂÖ®Êñá‚ÄùÔºåÊèê‰æõ‰∫∫Â∑•ÈªûÊìäÊèêÁ§∫ËàáË∑≥ËΩâÂÆö‰ΩçËºîÂä©
// @match        https://user.qzone.qq.com/*
// @grant        none
// ==/UserScript==

(function () {
    'use strict';

    let scrollInterval = null;
    const scrollSpeed = 2000;
    const intervalTime = 30;

    // ÊªæÂãïÊåâÈàï
    const btnScroll = document.createElement('button');
    btnScroll.textContent = 'üåÄ ÊªæÂãï';
    btnScroll.style.position = 'fixed';
    btnScroll.style.bottom = '20px';
    btnScroll.style.right = '20px';
    btnScroll.style.zIndex = '9999';
    btnScroll.style.padding = '8px 12px';
    btnScroll.style.background = '#222';
    btnScroll.style.color = '#fff';
    btnScroll.style.border = 'none';
    btnScroll.style.borderRadius = '6px';
    btnScroll.style.fontSize = '14px';
    btnScroll.style.cursor = 'pointer';
    btnScroll.style.opacity = '0.8';

    let scrolling = false;

    btnScroll.onclick = function () {
        if (!scrolling) {
            scrollInterval = setInterval(() => {
                window.scrollBy(0, scrollSpeed);
                highlightExpandLinks();
            }, intervalTime);
            btnScroll.textContent = 'üõë ÂÅúÊ≠¢';
            scrolling = true;
            console.log('[ÈñãÂßãÁòãÁãÇÊªæÂãï + Ê®ôË®ò]');
        } else {
            clearInterval(scrollInterval);
            btnScroll.textContent = 'üåÄ ÊªæÂãï';
            scrolling = false;
            console.log('[ÂÅúÊ≠¢ÊªæÂãï]');
        }
    };

    document.body.appendChild(btnScroll);

    // È´ò‰∫Æ‰∏¶Ê®ôË®òÊâÄÊúâ‚ÄúÂ±ïÈñãÂÖ®Êñá‚Äù
    function highlightExpandLinks() {
        const links = document.querySelectorAll('a[data-cmd="qz_toggle"]');
        links.forEach((link, idx) => {
            if (link.innerText.includes("Â±ïÂºÄÂÖ®Êñá") && !link.classList.contains('expand-helper')) {
                const jumpBtn = document.createElement('button');
                jumpBtn.textContent = `üîç Â±ïÈñã(${idx + 1})`;
                jumpBtn.style.marginLeft = '6px';
                jumpBtn.style.padding = '2px 6px';
                jumpBtn.style.fontSize = '10px';
                jumpBtn.style.cursor = 'pointer';
                jumpBtn.style.background = '#ffcc00';
                jumpBtn.style.color = '#000';
                jumpBtn.style.border = '1px solid #999';
                jumpBtn.style.borderRadius = '3px';

                jumpBtn.onclick = function (e) {
                    e.stopPropagation();
                    link.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    link.style.background = '#ffeeaa';
                    link.style.outline = '2px dashed red';
                    link.style.transition = 'all 0.3s';
                };

                link.parentNode.insertBefore(jumpBtn, link.nextSibling);
                link.classList.add('expand-helper');
            }
        });
    }
})();